import{D as m,p as f,h as P,v as L,C as M,c as $,o as W,ah as l,j as i,G as h,a,N as k,k as e,a2 as b,ai as Y,aj as U}from"./chunks/framework.DM5DyJ2q.js";import{s as H,c as C,b as v,j as g,w as r,y as Z,x as G,k as D,p as Q,G as S,b1 as j,aL as z,e as J,bq as K,c0 as y,bP as ss,bX as is}from"./chunks/theme.C_36pXDy.js";import{a as X}from"./chunks/alphabet.B9gro12k.js";import{c as B}from"./chunks/crimea.B-lNWU1a.js";const as={class:"label-input"},ts={class:"label-input"},ns={class:"label-input"},os=JSON.parse('{"title":"Stack transform","description":"","frontmatter":{},"headers":[],"relativePath":"transforms/stack.md","filePath":"transforms/stack.md"}'),es={name:"transforms/stack.md"},Es=Object.assign(es,{setup(ls){const q=m([]),c=f("wiggle"),I=P(()=>c.value==="null"?null:c.value),u=f("appearance"),O=P(()=>u.value==="null"?null:u.value),F=f(!0),o=m([]),x=m([]),E=H({color:{type:"categorical"}}).range;L(()=>{C("../data/riaa-us-revenue.csv",v).then(p=>o.value=p),C("../data/survey.csv",v).then(p=>x.value=p),C("../data/us-congress-2023.csv",v).then(p=>q.value=p)});function V(p){const s=new Map(p);return{order:Array.from(s.keys()),offset(n,t,T,N){for(const R of n)for(const w of R){const _=is(w,d=>(T[d]-t[d])*(1-s.get(N[d])))/2;for(const d of w)t[d]-=_,T[d]-=_}}}}const A=V([["Strongly Disagree",-1],["Disagree",-1],["Neutral",0],["Agree",1],["Strongly Agree",1]]);return(p,s)=>{const n=M("PlotRender");return W(),$("div",null,[s[37]||(s[37]=l("",2)),i("p",null,[s[3]||(s[3]=a("For example, below is a stacked area chart of ")),s[4]||(s[4]=i("a",{href:"https://en.wikipedia.org/wiki/Florence_Nightingale#Crimean_War",target:"_blank",rel:"noreferrer"},"deaths in the Crimean War",-1)),s[5]||(s[5]=a(" — predominantly from ")),i("span",{style:k({borderBottom:`solid ${e(E)[0]} 3px`})},"disease",4),s[6]||(s[6]=a(" — using Florence Nightingale’s data."))]),h(n,{options:{y:{grid:!0},color:{legend:!0},marks:[g(e(B),{x:"date",y:"deaths",fill:"cause"}),r([0])]}},null,8,["options"]),s[38]||(s[38]=l("",4)),h(n,{options:{y:{grid:!0},marks:[Z(e(B),{x:"date",y:"deaths",interval:"month",fill:"cause"}),r([0])]}},null,8,["options"]),s[39]||(s[39]=l("",4)),h(n,{options:{x:{interval:"month",tickFormat:t=>t.toLocaleString("en",{month:"narrow"}),label:null},y:{grid:!0},marks:[G(e(B),{x:"date",y:"deaths",fill:"cause"}),r([0])]}},null,8,["options"]),s[40]||(s[40]=l("",4)),h(n,{options:{x:{percent:!0},marks:[D(e(X),j({x:"frequency",fillOpacity:.3,inset:.5})),Q(e(X),j({x:"frequency",text:"letter",inset:.5})),S([0,1])]}},null,8,["options"]),s[41]||(s[41]=l("",2)),i("p",null,[s[7]||(s[7]=a("The ")),s[8]||(s[8]=i("strong",null,"order",-1)),s[9]||(s[9]=a(" option controls the order in which the layers are stacked. It defaults to null, meaning to respect the input order of the data. The ")),s[10]||(s[10]=i("em",null,"appearance",-1)),s[11]||(s[11]=a(" order excels when each series has a prominent peak, as in the chart below of ")),s[12]||(s[12]=i("a",{href:"https://en.wikipedia.org/wiki/Recording_Industry_Association_of_America",target:"_blank",rel:"noreferrer"},"recording industry",-1)),s[13]||(s[13]=a(" revenue. ")),i("span",{style:k({borderBottom:`solid 2px ${e(E)[0]}`})},"Compact disc",4),s[14]||(s[14]=a(" sales started declining well before the rise of ")),i("span",{style:k({borderBottom:`solid 2px ${e(E)[1]}`})},"downloads",4),s[15]||(s[15]=a(" and ")),i("span",{style:k({borderBottom:`solid 2px ${e(E)[3]}`})},"streaming",4),s[16]||(s[16]=a(", suggesting that the industry was slow to provide a convenient digital product and hence lost revenue to piracy."))]),i("p",null,[i("label",as,[s[18]||(s[18]=a(" Order: ")),b(i("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>u.value=t)},s[17]||(s[17]=[i("option",null,"null",-1),i("option",null,"appearance",-1),i("option",null,"inside-out",-1),i("option",null,"sum",-1),i("option",null,"group",-1),i("option",null,"z",-1)]),512),[[Y,u.value]])])]),h(n,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:t=>t/1e3},color:{legend:!0},marks:[g(o.value,{x:"year",y:"revenue",z:"format",fill:"group",order:O.value}),r([0])]}},null,8,["options"]),s[42]||(s[42]=l("",4)),i("p",null,[i("label",ts,[s[19]||(s[19]=a(" Reverse: ")),b(i("input",{type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=t=>F.value=t)},null,512),[[U,F.value]])])]),h(n,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:t=>t/1e3},color:{legend:!0},marks:[g(o.value,z({order:"appearance",reverse:F.value},{x:"year",y:"revenue",z:"format",fill:"group"})),r([0])]}},null,8,["options"]),s[43]||(s[43]=l("",4)),h(n,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:t=>t/1e3},marks:[g(o.value,{x:"year",y:"revenue",z:"format",fill:"group",order:"value"}),r([0])]}},null,8,["options"]),s[44]||(s[44]=l("",3)),i("p",null,[i("label",ns,[s[21]||(s[21]=a(" Offset: ")),b(i("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>c.value=t)},s[20]||(s[20]=[i("option",null,"null",-1),i("option",null,"center",-1),i("option",null,"wiggle",-1)]),512),[[Y,c.value]])])]),h(n,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:t=>t/1e3},marks:[g(o.value,{x:"year",y:"revenue",z:"format",fill:"group",offset:I.value})]}},null,8,["options"]),s[45]||(s[45]=l("",3)),i("p",null,[s[22]||(s[22]=a("The ")),s[23]||(s[23]=i("em",null,"normalize",-1)),s[24]||(s[24]=a()),s[25]||(s[25]=i("strong",null,"offset",-1)),s[26]||(s[26]=a(" is again worth special mention: it scales stacks to fill the interval [0, 1], thereby showing the relative proportion of each layer. Sales of ")),i("span",{style:k({borderBottom:`solid 2px ${e(E)[0]}`})},"compact discs",4),s[27]||(s[27]=a(" accounted for over 90% of revenue in the early 2000’s, but now most revenue comes from ")),i("span",{style:k({borderBottom:`solid 2px ${e(E)[3]}`})},"streaming",4),s[28]||(s[28]=a("."))]),h(n,{defer:"",options:{y:{label:"Annual revenue (%)",percent:!0},marks:[g(o.value,z({offset:"normalize",order:"group",reverse:!0},{x:"year",y:"revenue",z:"format",fill:"group"})),r([0,1])]}},null,8,["options"]),s[46]||(s[46]=l("",3)),h(n,{defer:"",options:{aspectRatio:1,x:{label:"Age (years)"},y:{grid:!0,label:"← Women · Men →",labelAnchor:"center",tickFormat:Math.abs},marks:[J(q.value,K({x:t=>2023-t.birthday.getUTCFullYear(),y:t=>t.gender==="M"?1:-1,fill:"gender",title:"full_name"})),r([0])]}},null,8,["options"]),s[47]||(s[47]=l("",3)),i("p",null,[s[29]||(s[29]=a("When visualizing ")),s[30]||(s[30]=i("a",{href:"https://en.wikipedia.org/wiki/Likert_scale",target:"_blank",rel:"noreferrer"},"Likert scale",-1)),s[31]||(s[31]=a(" survey results we may wish to place ")),i("span",{style:k({borderWidth:2,borderBottomStyle:"solid",borderImage:`linear-gradient(to right, ${y[5][0]}, ${y[5][1]}) 2`})},"negative",4),s[32]||(s[32]=a(" (disagreeing) responses on the left and ")),i("span",{style:k({borderWidth:2,borderBottomStyle:"solid",borderImage:`linear-gradient(to right, ${y[5][3]}, ${y[5][4]}) 2`})},"positive",4),s[33]||(s[33]=a(" (agreeing) responses on the right, leaving ")),i("span",{style:k({borderBottom:`solid 2px ${y[5][2]}`})},"neutral",4),s[34]||(s[34]=a(" responses in the middle. This is achieved below using a custom ")),s[35]||(s[35]=i("strong",null,"offset",-1)),s[36]||(s[36]=a(" function."))]),h(n,{defer:"",options:{x:{tickFormat:Math.abs},color:{domain:e(A).order,scheme:"RdBu",legend:!0},marks:[D(x.value,ss({x:"count"},{fy:"Question",fill:"Response",...e(A)})),S([0])]}},null,8,["options"]),s[48]||(s[48]=l("",39))])}}});export{os as __pageData,Es as default};
